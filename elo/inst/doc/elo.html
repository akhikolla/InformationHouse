<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Ethan Heinzen" />

<meta name="date" content="2020-01-14" />

<title>The ‘elo’ Package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">The ‘elo’ Package</h1>
<h4 class="author">Ethan Heinzen</h4>
<h4 class="date">2020-01-14</h4>


<div id="TOC">
<ul>
<li><a href="#the-elo-package">The <code>elo</code> Package</a><ul>
<li><a href="#naming-schema">Naming Schema</a></li>
</ul></li>
<li><a href="#basic-functions">Basic Functions</a></li>
<li><a href="#the-elo.run-function">The <code>elo.run()</code> function</a><ul>
<li><a href="#with-two-variable-elos">With two variable Elos</a></li>
<li><a href="#with-a-fixed-elo-opponent">With a fixed-Elo opponent</a></li>
<li><a href="#regress-elos-back-to-the-mean">Regress Elos back to the mean</a></li>
<li><a href="#group-matches">Group matches</a></li>
<li><a href="#helper-functions">Helper functions</a></li>
<li><a href="#making-predictions">Making Predictions</a></li>
<li><a href="#advanced-custom-probability-and-updates">Advanced: custom probability and updates</a></li>
</ul></li>
<li><a href="#basic-functions-revisited---formula-interface">Basic Functions Revisited - Formula Interface</a></li>
<li><a href="#comparison-models">Comparison Models</a><ul>
<li><a href="#winloss-logistic-regression">Win/Loss Logistic Regression</a></li>
<li><a href="#logistic-regression">Logistic Regression</a></li>
<li><a href="#markov-chain">Markov Chain</a><ul>
<li><a href="#a-note-about-lrmc">A note about LRMC</a></li>
</ul></li>
<li><a href="#colley-matrix-method">Colley Matrix Method</a></li>
</ul></li>
<li><a href="#modeling-margin-of-victory-instead-of-wins">Modeling Margin of Victory Instead of Wins</a></li>
</ul>
</div>

<div id="the-elo-package" class="section level1">
<h1>The <code>elo</code> Package</h1>
<p>The <code>elo</code> package includes functions to address all kinds of Elo calculations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(elo)</a></code></pre></div>
<div id="naming-schema" class="section level2">
<h2>Naming Schema</h2>
<p>Most functions begin with the prefix “elo.”, for easy autocompletion.</p>
<ul>
<li><p>Vectors or scalars of Elo scores are denoted <code>elo.A</code> or <code>elo.B</code>.</p></li>
<li><p>Vectors or scalars of wins by team A are denoted by <code>wins.A</code>.</p></li>
<li><p>Vectors or scalars of win probabilities are denoted by <code>p.A</code>.</p></li>
<li><p>Vectors of team names are denoted <code>team.A</code> or <code>team.B</code>.</p></li>
</ul>
</div>
</div>
<div id="basic-functions" class="section level1">
<h1>Basic Functions</h1>
<p>To calculate the probability team.A beats team.B, use <code>elo.prob()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">elo.A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1500</span>, <span class="dv">1500</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">elo.B &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1500</span>, <span class="dv">1600</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">elo.prob</span>(elo.A, elo.B)</a></code></pre></div>
<pre><code>## [1] 0.500000 0.359935</code></pre>
<p>To calculate the score update after the two teams play, use <code>elo.update()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">wins.A &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">elo.update</span>(wins.A, elo.A, elo.B, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## [1] 10.0000 -7.1987</code></pre>
<p>To calculate the new Elo scores after the update, use <code>elo.calc()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">elo.calc</span>(wins.A, elo.A, elo.B, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>##      elo.A    elo.B
## 1 1510.000 1490.000
## 2 1492.801 1607.199</code></pre>
</div>
<div id="the-elo.run-function" class="section level1">
<h1>The <code>elo.run()</code> function</h1>
<div id="with-two-variable-elos" class="section level2">
<h2>With two variable Elos</h2>
<p>To calculate a series of Elo updates, use <code>elo.run()</code>. This function has a <code>formula =</code> and <code>data =</code> interface. We first load the dataset <code>tournament</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">data</span>(tournament)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">str</span>(tournament)</a></code></pre></div>
<pre><code>## 'data.frame':    56 obs. of  6 variables:
##  $ team.Home     : chr  &quot;Blundering Baboons&quot; &quot;Defense-less Dogs&quot; &quot;Fabulous Frogs&quot; &quot;Helpless Hyenas&quot; ...
##  $ team.Visitor  : chr  &quot;Athletic Armadillos&quot; &quot;Cunning Cats&quot; &quot;Elegant Emus&quot; &quot;Gallivanting Gorillas&quot; ...
##  $ points.Home   : num  14 21 15 13 22 18 20 23 25 23 ...
##  $ points.Visitor: num  22 18 11 15 13 20 22 10 16 18 ...
##  $ week          : num  1 1 1 1 2 2 2 2 3 3 ...
##  $ half          : chr  &quot;First Half of Season&quot; &quot;First Half of Season&quot; &quot;First Half of Season&quot; &quot;First Half of Season&quot; ...</code></pre>
<p><code>formula =</code> should be in the format of <code>wins.A ~ team.A + team.B</code>. The <code>score()</code> function will help to calculate winners on the fly (1 = win, 0.5 = tie, 0 = loss).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">tournament<span class="op">$</span>wins.A &lt;-<span class="st"> </span>tournament<span class="op">$</span>points.Home <span class="op">&gt;</span><span class="st"> </span>tournament<span class="op">$</span>points.Visitor</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">elo.run</span>(wins.A <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor, <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor, <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
<p>For more complicated Elo updates, you can include the special function <code>k()</code> in the <code>formula =</code> argument. Here we’re taking the log of the win margin as part of our update.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">        </span><span class="kw">k</span>(<span class="dv">20</span><span class="op">*</span><span class="kw">log</span>(<span class="kw">abs</span>(points.Home <span class="op">-</span><span class="st"> </span>points.Visitor) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)), <span class="dt">data =</span> tournament)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
<p>You can also adjust the home and visitor teams with different k’s:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">k1 &lt;-<span class="st"> </span><span class="dv">20</span><span class="op">*</span><span class="kw">log</span>(<span class="kw">abs</span>(tournament<span class="op">$</span>points.Home <span class="op">-</span><span class="st"> </span>tournament<span class="op">$</span>points.Visitor) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">k</span>(k1, k1<span class="op">/</span><span class="dv">2</span>), <span class="dt">data =</span> tournament)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
<p>It’s also possible to adjust one team’s Elo for a variety of factors (e.g., home-field advantage). The <code>adjust()</code> special function will take as its second argument a vector or a constant.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span><span class="kw">adjust</span>(team.Home, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span>team.Visitor,</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">        <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
</div>
<div id="with-a-fixed-elo-opponent" class="section level2">
<h2>With a fixed-Elo opponent</h2>
<p><code>elo.run()</code> also recognizes if the second column is numeric, and interprets that as a fixed-Elo opponent.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">tournament<span class="op">$</span>elo.Visitor &lt;-<span class="st"> </span><span class="dv">1500</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>elo.Visitor,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">        <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.</code></pre>
</div>
<div id="regress-elos-back-to-the-mean" class="section level2">
<h2>Regress Elos back to the mean</h2>
<p>The special function <code>regress()</code> can be used to regress Elos back to a fixed value after certain matches. Giving a logical vector identifies these matches after which to regress back to the mean. Giving any other kind of vector regresses after the appropriate groupings (see, e.g., <code>duplicated(..., fromLast = TRUE)</code>). The other three arguments determine what Elo to regress to (<code>to =</code>, which could be a different value for different teams), by how much to regress toward that value (<code>by =</code>), and whether to regress teams which aren’t actively playing (<code>regress.unused =</code>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">tournament<span class="op">$</span>elo.Visitor &lt;-<span class="st"> </span><span class="dv">1500</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>elo.Visitor <span class="op">+</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">        </span><span class="kw">regress</span>(half, <span class="dv">1500</span>, <span class="fl">0.2</span>),</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">        <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run.regressed', containing information on 8 teams and 56 matches, with 2 regressions.</code></pre>
</div>
<div id="group-matches" class="section level2">
<h2>Group matches</h2>
<p>The special function <code>group()</code> doesn’t affect <code>elo.run()</code>, but determines matches to group together in <code>as.matrix()</code> (below).</p>
</div>
<div id="helper-functions" class="section level2">
<h2>Helper functions</h2>
<p>There are several helper functions that are useful to use when interacting with objects of class <code>&quot;elo.run&quot;</code>.</p>
<p><code>summary.elo.run()</code> reports some summary statistics.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">e &lt;-<span class="st"> </span><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor,</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">             <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw">summary</span>(e)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.run', containing information on 8 teams and 56 matches.
## 
## Mean Square Error: 0.2195
## AUC: 0.6304
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0 0.5  1
##   TRUE   6   1 16
##   (tie)  2   1  9
##   FALSE  8   3 10</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">rank.teams</span>(e)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##                     1                     7                     3 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##                     8                     5                     2 
## Gallivanting Gorillas       Helpless Hyenas 
##                     4                     6</code></pre>
<p><code>as.matrix.elo.run()</code> creates a matrix of running Elos.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">as.matrix</span>(e))</a></code></pre></div>
<pre><code>##      Athletic Armadillos Blundering Baboons Cunning Cats Defense-less Dogs
## [1,]            1510.000           1490.000     1500.000          1500.000
## [2,]            1510.000           1490.000     1490.000          1510.000
## [3,]            1510.000           1490.000     1490.000          1510.000
## [4,]            1510.000           1490.000     1490.000          1510.000
## [5,]            1499.425           1490.000     1500.575          1510.000
## [6,]            1499.425           1500.575     1500.575          1499.425
##      Elegant Emus Fabulous Frogs Gallivanting Gorillas Helpless Hyenas
## [1,]         1500           1500                  1500            1500
## [2,]         1500           1500                  1500            1500
## [3,]         1490           1510                  1500            1500
## [4,]         1490           1510                  1510            1490
## [5,]         1490           1510                  1510            1490
## [6,]         1490           1510                  1510            1490</code></pre>
<p><code>as.data.frame.elo.run()</code> gives the long version (perfect, for, e.g., <code>ggplot2</code>).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">as.data.frame</span>(e))</a></code></pre></div>
<pre><code>## 'data.frame':    56 obs. of  8 variables:
##  $ team.A  : Factor w/ 8 levels &quot;Athletic Armadillos&quot;,..: 2 4 6 8 3 4 7 8 4 3 ...
##  $ team.B  : Factor w/ 8 levels &quot;Athletic Armadillos&quot;,..: 1 3 5 7 1 2 5 6 1 2 ...
##  $ p.A     : num  0.5 0.5 0.5 0.5 0.471 ...
##  $ wins.A  : num  0 1 1 0 1 0 0 1 1 1 ...
##  $ update.A: num  -10 10 10 -10 10.6 ...
##  $ update.B: num  10 -10 -10 10 -10.6 ...
##  $ elo.A   : num  1490 1510 1510 1490 1501 ...
##  $ elo.B   : num  1510 1490 1490 1510 1499 ...</code></pre>
<p>Finally, <code>final.elos()</code> will extract the final Elos per team.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">final.elos</span>(e)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##              1564.318              1453.079              1518.019 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##              1421.394              1509.851              1532.986 
## Gallivanting Gorillas       Helpless Hyenas 
##              1513.944              1486.411</code></pre>
</div>
<div id="making-predictions" class="section level2">
<h2>Making Predictions</h2>
<p>It is also possible to use the Elos calculated by <code>elo.run()</code> to make predictions on future match-ups.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span><span class="kw">adjust</span>(team.Home, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span>team.Visitor,</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">                   <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">newdat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">  <span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>,</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">  <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="kw">predict</span>(results, <span class="dt">newdata =</span> newdat)</a></code></pre></div>
<pre><code>## [1] 0.6676045</code></pre>
</div>
<div id="advanced-custom-probability-and-updates" class="section level2">
<h2>Advanced: custom probability and updates</h2>
<p>We now get to <code>elo.run2()</code>, a copy of <code>elo.run()</code> (but implemented in R) that allows for custom probability calculations and Elo updates.</p>
<p>For instance, suppose you want to change the adjustment based on team A’s current Elo:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">custom_update &lt;-<span class="st"> </span><span class="cf">function</span>(wins.A, elo.A, elo.B, k, adjust.A, adjust.B, ...)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">  k<span class="op">*</span>(wins.A <span class="op">-</span><span class="st"> </span><span class="kw">elo.prob</span>(elo.A, elo.B, <span class="dt">adjust.B =</span> adjust.B,</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">                       <span class="dt">adjust.A =</span> <span class="kw">ifelse</span>(elo.A <span class="op">&gt;</span><span class="st"> </span><span class="dv">1500</span>, adjust.A <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, adjust.A)))</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">custom_prob &lt;-<span class="st"> </span><span class="cf">function</span>(elo.A, elo.B, adjust.A, adjust.B)</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">{</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span>(((elo.B <span class="op">+</span><span class="st"> </span>adjust.B) <span class="op">-</span><span class="st"> </span>(elo.A <span class="op">+</span><span class="st"> </span><span class="kw">ifelse</span>(elo.A <span class="op">&gt;</span><span class="st"> </span><span class="dv">1500</span>, adjust.A <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, adjust.A)))<span class="op">/</span><span class="fl">400.0</span>))</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb36-10" data-line-number="10">er2 &lt;-<span class="st"> </span><span class="kw">elo.run2</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span><span class="kw">adjust</span>(team.Home, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span>team.Visitor,</a>
<a class="sourceLine" id="cb36-11" data-line-number="11">                <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>, <span class="dt">prob.fun =</span> custom_prob, <span class="dt">update.fun =</span> custom_update)</a>
<a class="sourceLine" id="cb36-12" data-line-number="12"><span class="kw">final.elos</span>(er2)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##              1564.660              1452.278              1518.165 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##              1420.876              1510.015              1533.209 
## Gallivanting Gorillas       Helpless Hyenas 
##              1514.233              1486.564</code></pre>
<p>Compare this to the results from the default:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">er3 &lt;-<span class="st"> </span><span class="kw">elo.run</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span><span class="kw">adjust</span>(team.Home, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span>team.Visitor,</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">               <span class="dt">data =</span> tournament, <span class="dt">k =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="kw">final.elos</span>(er3)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##              1563.967              1452.822              1517.847 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##              1421.358              1509.906              1533.127 
## Gallivanting Gorillas       Helpless Hyenas 
##              1514.205              1486.768</code></pre>
<p>This example is a bit contrived, as it’d be easier just to use <code>adjust()</code> (actually, this is tested for in the tests), but the point remains.</p>
</div>
</div>
<div id="basic-functions-revisited---formula-interface" class="section level1">
<h1>Basic Functions Revisited - Formula Interface</h1>
<p>All three of the “basic” functions accept formulas as input, just like <code>elo.run()</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">elo.A =</span> <span class="kw">c</span>(<span class="dv">1500</span>, <span class="dv">1500</span>), <span class="dt">elo.B =</span> <span class="kw">c</span>(<span class="dv">1500</span>, <span class="dv">1600</span>),</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">                  <span class="dt">wins.A =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">k =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">form &lt;-<span class="st"> </span>wins.A <span class="op">~</span><span class="st"> </span>elo.A <span class="op">+</span><span class="st"> </span>elo.B <span class="op">+</span><span class="st"> </span><span class="kw">k</span>(k)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="kw">elo.prob</span>(form, <span class="dt">data =</span> dat)</a></code></pre></div>
<pre><code>## [1] 0.500000 0.359935</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">elo.update</span>(form, <span class="dt">data =</span> dat)</a></code></pre></div>
<pre><code>## [1] 10.0000 -7.1987</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">elo.calc</span>(form, <span class="dt">data =</span> dat)</a></code></pre></div>
<pre><code>##      elo.A    elo.B
## 1 1510.000 1490.000
## 2 1492.801 1607.199</code></pre>
<p>Note that for <code>elo.prob()</code>, <code>formula =</code> can be more succinct:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">elo.prob</span>(<span class="op">~</span><span class="st"> </span>elo.A <span class="op">+</span><span class="st"> </span>elo.B, <span class="dt">data =</span> dat)</a></code></pre></div>
<pre><code>## [1] 0.500000 0.359935</code></pre>
<p>We can even adjust the Elos:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">elo.calc</span>(wins.A <span class="op">~</span><span class="st"> </span><span class="kw">adjust</span>(elo.A, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span>elo.B <span class="op">+</span><span class="st"> </span><span class="kw">k</span>(k), <span class="dt">data =</span> dat)</a></code></pre></div>
<pre><code>##      elo.A    elo.B
## 1 1509.712 1490.288
## 2 1492.534 1607.466</code></pre>
</div>
<div id="comparison-models" class="section level1">
<h1>Comparison Models</h1>
<div id="winloss-logistic-regression" class="section level2">
<h2>Win/Loss Logistic Regression</h2>
<p>The first model computes teams’ win percentages, and feeds the differences of percentages into a regression. Including an adjustment using <code>adjust()</code> in the formula also includes that in the model. You could also adjust the intercept for games played on neutral fields by using the <code>neutral()</code> function.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">e.winpct &lt;-<span class="st"> </span><span class="kw">elo.winpct</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">                       <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor) <span class="co"># to get rid of ties for now</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="kw">summary</span>(e.winpct)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.winpct', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1566
## AUC: 0.8339
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   7 32
##   (tie)  0  0
##   FALSE  9  3</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">rank.teams</span>(e.winpct)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##                     1                     7                     4 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##                     8                     5                     2 
## Gallivanting Gorillas       Helpless Hyenas 
##                     3                     6</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">predict</span>(e.winpct, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<pre><code>##         1 
## 0.9690678</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">tournament<span class="op">$</span>neutral &lt;-<span class="st"> </span><span class="kw">replace</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(tournament)), <span class="dv">30</span><span class="op">:</span><span class="dv">35</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">elo.winpct</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">neutral</span>(neutral) <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week),</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">                   <span class="dt">data =</span> tournament, <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor))</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.winpct', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1565
## AUC: 0.825
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   6 32
##   (tie)  0  0
##   FALSE 10  3</code></pre>
<p>The models can be built “running”, where predictions for the next group of games are made based on past data. Consider using the <code>skip=</code> argument to skip the first few groups (otherwise the model might have trouble converging).</p>
<p>Note that predictions from this object use a model fit on all the data.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">e.winpct &lt;-<span class="st"> </span><span class="kw">elo.winpct</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb58-2" data-line-number="2">                       <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">running =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="kw">summary</span>(e.winpct)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.winpct', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1769
## AUC: 0.8339
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   5 21
##   (tie)  6 13
##   FALSE  5  1</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">predict</span>(e.winpct, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)) <span class="co"># the same thing</span></a></code></pre></div>
<pre><code>##         1 
## 0.9690678</code></pre>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
<p>It’s also possible to compare teams’ skills using logistic regression. A matrix of dummy variables is constructed, one for each team, where a value of 1 indicates a home team and -1 indicates a visiting team. The intercept then indicates a home-field advantage. To denote games played in a neutral setting (that is, without home-field advantage), use the <code>neutral()</code> function. In short, the intercept will then be set to <code>1 - neutral()</code>. Including an adjustment using <code>adjust()</code> in the formula also includes that in the model.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">elo.glm</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">                   <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor) <span class="co"># to get rid of ties for now</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="kw">summary</span>(results)</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = wins.A ~ . - 1, family = family, data = dat, 
##     weights = wts, subset = NULL, na.action = stats::na.pass)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0108  -0.8255   0.4050   0.6560   2.1217  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)   
## home.field                1.0307     0.3871   2.663  0.00775 **
## `Athletic Armadillos`     1.4289     0.9546   1.497  0.13442   
## `Blundering Baboons`     -0.9637     0.9043  -1.066  0.28659   
## `Cunning Cats`            0.5377     0.9483   0.567  0.57074   
## `Defense-less Dogs`      -1.7413     1.0356  -1.681  0.09268 . 
## `Elegant Emus`            0.3931     0.8818   0.446  0.65576   
## `Fabulous Frogs`          0.8489     0.8807   0.964  0.33509   
## `Gallivanting Gorillas`   0.3994     0.9500   0.420  0.67417   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 70.701  on 51  degrees of freedom
## Residual deviance: 48.037  on 43  degrees of freedom
## AIC: 64.037
## 
## Number of Fisher Scoring iterations: 5
## 
## Mean Square Error: 0.1566
## AUC: 0.8375
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   7 32
##   (tie)  0  0
##   FALSE  9  3</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">rank.teams</span>(results)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##                     1                     7                     3 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##                     8                     5                     2 
## Gallivanting Gorillas       Helpless Hyenas 
##                     4                     6</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">predict</span>(results, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<pre><code>##         1 
## 0.9684256</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">elo.glm</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">neutral</span>(neutral) <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week),</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">                <span class="dt">data =</span> tournament, <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor))</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = wins.A ~ . - 1, family = family, data = dat, 
##     weights = wts, subset = NULL, na.action = stats::na.pass)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0349  -0.7789   0.3933   0.7618   2.2148  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)  
## home.field                1.0886     0.4229   2.574   0.0101 *
## `Athletic Armadillos`     1.6006     0.9750   1.642   0.1007  
## `Blundering Baboons`     -0.8541     0.8930  -0.956   0.3389  
## `Cunning Cats`            0.5801     0.9446   0.614   0.5391  
## `Defense-less Dogs`      -1.8507     1.0449  -1.771   0.0765 .
## `Elegant Emus`            0.5762     0.8994   0.641   0.5218  
## `Fabulous Frogs`          0.8470     0.8804   0.962   0.3360  
## `Gallivanting Gorillas`   0.5777     0.9279   0.623   0.5335  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 70.701  on 51  degrees of freedom
## Residual deviance: 48.405  on 43  degrees of freedom
## AIC: 64.405
## 
## Number of Fisher Scoring iterations: 5
## 
## Mean Square Error: 0.1556
## AUC: 0.8375
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   7 32
##   (tie)  0  0
##   FALSE  9  3</code></pre>
<p>The models can be built “running”, where predictions for the next group of games are made based on past data. Consider using the <code>skip=</code> argument to skip the first few groups (otherwise the model might have trouble converging).</p>
<p>Note that predictions from this object use a model fit on all the data.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">elo.glm</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">                   <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">running =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="kw">summary</span>(results)</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = wins.A ~ . - 1, family = family, data = dat, 
##     weights = wts, subset = NULL, na.action = stats::na.pass)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0108  -0.8255   0.4050   0.6560   2.1217  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)   
## home.field                1.0307     0.3871   2.663  0.00775 **
## `Athletic Armadillos`     1.4289     0.9546   1.497  0.13442   
## `Blundering Baboons`     -0.9637     0.9043  -1.066  0.28659   
## `Cunning Cats`            0.5377     0.9483   0.567  0.57074   
## `Defense-less Dogs`      -1.7413     1.0356  -1.681  0.09268 . 
## `Elegant Emus`            0.3931     0.8818   0.446  0.65576   
## `Fabulous Frogs`          0.8489     0.8807   0.964  0.33509   
## `Gallivanting Gorillas`   0.3994     0.9500   0.420  0.67417   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 70.701  on 51  degrees of freedom
## Residual deviance: 48.037  on 43  degrees of freedom
## AIC: 64.037
## 
## Number of Fisher Scoring iterations: 5
## 
## Mean Square Error: 0.2098
## AUC: 0.8375
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   6 19
##   (tie)  6 13
##   FALSE  4  3</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">predict</span>(results, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)) <span class="co"># the same thing</span></a></code></pre></div>
<pre><code>##         1 
## 0.9684256</code></pre>
</div>
<div id="markov-chain" class="section level2">
<h2>Markov Chain</h2>
<p>It’s also possible to compare teams’ skills using a Markov-chain-based model, as outlined in <a href="https://scholarship.richmond.edu/cgi/viewcontent.cgi?article=1207&amp;context=mathcs-faculty-publications">Kvam and Sokol (2006)</a>. In short, imagine a judge who randomly picks one of two teams in a matchup, where the winner gets chosen with probability p (here, for convenience, ‘k’) and the loser with probability 1-p (1-k). In other words, we assume that the probability that the winning team is better than the losing team given that it won is k, and the probability that the losing team is better than the winning team given that it lost is (1-k). This forms a transition matrix, whose stationary distribution gives a ranking of teams. The differences in ranking are then fed into a logistic regession model to predict win status. Any adjustments made using <code>adjust()</code> are also included in this logistic regression. You could also adjust the intercept for games played on neutral fields by using the <code>neutral()</code> function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">mc &lt;-<span class="st"> </span><span class="kw">elo.markovchain</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor, <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">                      <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">k =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="kw">summary</span>(mc)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.markovchain', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1688
## AUC: 0.8
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE  10 29
##   (tie)  0  0
##   FALSE  6  6</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">rank.teams</span>(mc)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##                     1                     7                     3 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##                     8                     4                     2 
## Gallivanting Gorillas       Helpless Hyenas 
##                     6                     5</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">predict</span>(mc, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<pre><code>##         1 
## 0.9594476</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">elo.markovchain</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">neutral</span>(neutral),</a>
<a class="sourceLine" id="cb80-2" data-line-number="2">                        <span class="dt">data =</span> tournament, <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">k =</span> <span class="fl">0.7</span>))</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.markovchain', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1732
## AUC: 0.7857
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE  10 28
##   (tie)  0  0
##   FALSE  6  7</code></pre>
<p>These models can also be built “running”, where predictions for the next group of games are made based on past data. Consider using the <code>skip=</code> argument to skip the first few groups (otherwise the model might have trouble converging).</p>
<p>Note that predictions from this object use a model fit on all the data.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">mc &lt;-<span class="st"> </span><span class="kw">elo.markovchain</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb82-2" data-line-number="2">                      <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">k =</span> <span class="fl">0.7</span>, <span class="dt">running =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb82-3" data-line-number="3"><span class="kw">summary</span>(mc)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.markovchain', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.229
## AUC: 0.8
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   6 19
##   (tie)  6 13
##   FALSE  4  3</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">predict</span>(mc, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)) <span class="co"># the same thing</span></a></code></pre></div>
<pre><code>##         1 
## 0.9594476</code></pre>
<div id="a-note-about-lrmc" class="section level3">
<h3>A note about LRMC</h3>
<p>Note that by assigning probabilities in the right way, this function emits the Logistic Regression Markov Chain model (LRMC). Use the in-formula function <code>k()</code> for this. IMPORTANT: note that <code>k()</code> denotes the probability assigned to the <em>winning</em> team, not the <em>home</em> team (for instance). If <code>rH(x)</code> denotes the probability that the home team is better given that they scored <code>x</code> points more than the visiting team (allowing for x to be negative), then an LRMC model might look something like this:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">elo.markovchain</span>(<span class="kw">floor</span>(wins.home) <span class="op">~</span><span class="st"> </span>team.home <span class="op">+</span><span class="st"> </span>team.visitor <span class="op">+</span><span class="st"> </span><span class="kw">k</span>(<span class="kw">ifelse</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">rH</span>(x), <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">rH</span>(x))))</a></code></pre></div>
<p>Why do we use <code>floor()</code> here? This takes care of the odd case where teams tie. In this case, <code>rH(x) &lt; 0.5</code> because we expected the home team to win by virtue of being home. By default, <code>elo.markovchain()</code> will split any ties down the middle (i.e., 0.5 and 0.5 instead of p and 1-p), which isn’t what we want; we want the visiting team to get a larger share than the home team. Telling <code>elo.markovchain()</code> that the visiting team “won” gives the visiting team its whole share of <code>p</code>.</p>
<p>Alternatively, if <code>h</code> denotes a home-field advantage (in terms of score), the model becomes:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="kw">elo.markovchain</span>(<span class="kw">ifelse</span>(home.points <span class="op">-</span><span class="st"> </span>visitor.points <span class="op">&gt;</span><span class="st"> </span>h, <span class="dv">1</span>, <span class="dv">0</span>) <span class="op">~</span><span class="st"> </span>team.home <span class="op">+</span><span class="st"> </span>team.visitor <span class="op">+</span><span class="st"> </span><span class="kw">k</span>(<span class="kw">pmax</span>(<span class="kw">rH</span>(x), <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">rH</span>(x))))</a></code></pre></div>
<p>In this case, the home team “won” if it scored more than <code>h</code> points more than the visiting team. Since <code>rH(x) &gt; 0.5</code> if <code>x &gt; h</code>, then <code>pmax()</code> will assign the proper probability to the pseudo-winning team.</p>
<p>Finally, do note that using <code>neutral()</code> isn’t sufficient for adjusting for games played on neutral ground, because the adjustment is only taken into account in the logistic regression to produce probabilities, not the building of the transition matrix. Therefore, you’ll want to also account for neutral wins/losses in <code>k()</code> as well.</p>
</div>
</div>
<div id="colley-matrix-method" class="section level2">
<h2>Colley Matrix Method</h2>
<p>It’s also possible to compare teams’ skills using the Colley Matrix method, as outlined in <a href="http://www.colleyrankings.com/matrate.pdf">Colley (2002)</a>. The coefficients to the Colley matrix formulation gives a ranking of teams. The differences in ranking are then fed into a logistic regession model to predict win status. Here ‘k’ denotes how convincing a win is; it represents the fraction of the win assigned to the winning team and the fraction of the loss assigned to the losing team. Setting ‘k’ = 1 emits the bias-free method presented by Colley. Any adjustments made using <code>adjust()</code> are also included in this logistic regression. You could also adjust the intercept for games played on neutral fields by using the <code>neutral()</code> function.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">co &lt;-<span class="st"> </span><span class="kw">elo.colley</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor, <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">                 <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="kw">summary</span>(co)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.colley', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1565
## AUC: 0.8339
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   7 32
##   (tie)  0  0
##   FALSE  9  3</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">rank.teams</span>(co)</a></code></pre></div>
<pre><code>##   Athletic Armadillos    Blundering Baboons          Cunning Cats 
##                     1                     7                     4 
##     Defense-less Dogs          Elegant Emus        Fabulous Frogs 
##                     8                     5                     2 
## Gallivanting Gorillas       Helpless Hyenas 
##                     3                     6</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">predict</span>(co, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<pre><code>##         1 
## 0.9687583</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">elo.colley</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">neutral</span>(neutral),</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">                   <span class="dt">data =</span> tournament, <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor))</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.colley', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.1565
## AUC: 0.8268
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   6 32
##   (tie)  0  0
##   FALSE 10  3</code></pre>
<p>These models can also be built “running”, where predictions for the next group of games are made based on past data. Consider using the <code>skip=</code> argument to skip the first few groups (otherwise the model might have trouble converging).</p>
<p>Note that predictions from this object use a model fit on all the data.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">co &lt;-<span class="st"> </span><span class="kw">elo.colley</span>(<span class="kw">score</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor <span class="op">+</span><span class="st"> </span><span class="kw">group</span>(week), <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb96-2" data-line-number="2">                      <span class="dt">subset =</span> points.Home <span class="op">!=</span><span class="st"> </span>points.Visitor, <span class="dt">running =</span> <span class="ot">TRUE</span>, <span class="dt">skip =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="kw">summary</span>(co)</a></code></pre></div>
<pre><code>## 
## An object of class 'elo.colley', containing information on 8 teams and 51 matches.
## 
## Mean Square Error: 0.2173
## AUC: 0.8339
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored  0  1
##   TRUE   4 19
##   (tie)  6 13
##   FALSE  6  3</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">predict</span>(co, <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">team.Home =</span> <span class="st">&quot;Athletic Armadillos&quot;</span>, <span class="dt">team.Visitor =</span> <span class="st">&quot;Blundering Baboons&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)) <span class="co"># the same thing</span></a></code></pre></div>
<pre><code>##         1 
## 0.9687583</code></pre>
</div>
</div>
<div id="modeling-margin-of-victory-instead-of-wins" class="section level1">
<h1>Modeling Margin of Victory Instead of Wins</h1>
<p><code>elo.glm()</code>, <code>elo.markovchain()</code>, and <code>elo.winpct()</code> all allow for modeling of margins of victory instead of simple win/loss using the <code>mov()</code> function. Note that one must set the <code>family=&quot;gaussian&quot;</code> argument to get linear regression instead of logistic regression.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">summary</span>(<span class="kw">elo.glm</span>(<span class="kw">mov</span>(points.Home, points.Visitor) <span class="op">~</span><span class="st"> </span>team.Home <span class="op">+</span><span class="st"> </span>team.Visitor, <span class="dt">data =</span> tournament,</a>
<a class="sourceLine" id="cb100-2" data-line-number="2">                <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>))</a></code></pre></div>
<pre><code>## 
## Call:
## stats::glm(formula = wins.A ~ . - 1, family = family, data = dat, 
##     weights = wts, subset = NULL, na.action = stats::na.pass)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -10.6339   -2.8996   -0.0402    2.7879   12.9286  
## 
## Coefficients:
##                         Estimate Std. Error t value Pr(&gt;|t|)    
## home.field                2.6964     0.6941   3.885 0.000313 ***
## `Athletic Armadillos`     3.1250     1.8363   1.702 0.095263 .  
## `Blundering Baboons`     -2.4375     1.8363  -1.327 0.190655    
## `Cunning Cats`            0.3125     1.8363   0.170 0.865584    
## `Defense-less Dogs`      -3.5000     1.8363  -1.906 0.062646 .  
## `Elegant Emus`           -0.9375     1.8363  -0.511 0.612014    
## `Fabulous Frogs`          0.6875     1.8363   0.374 0.709759    
## `Gallivanting Gorillas`   0.2500     1.8363   0.136 0.892277    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 26.97582)
## 
##     Null deviance: 2161.0  on 56  degrees of freedom
## Residual deviance: 1294.8  on 48  degrees of freedom
## AIC: 352.81
## 
## Number of Fisher Scoring iterations: 2
## 
## Mean Square Error: 23.1221
## AUC: NA
## Favored Teams vs. Actual Wins: 
##        Actual
## Favored TRUE (tie) FALSE
##   TRUE    31     3    10
##   (tie)    0     0     0
##   FALSE    4     2     6</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
