<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Thomas W. Jones" />

<meta name="date" content="2019-04-17" />

<title>1. Start here</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">1. Start here</h1>
<h4 class="author">Thomas W. Jones</h4>
<h4 class="date">2019-04-17</h4>



<div id="why-textminer" class="section level1">
<h1>Why textmineR?</h1>
<p>textmineR was created with three principles in mind:</p>
<ol style="list-style-type: decimal">
<li>Maximize interoperability within R’s ecosystem</li>
<li>Scaleable in terms of object storage and computation time</li>
<li>Syntax that is idiomatic to R</li>
</ol>
<p>R has many packages for text mining and natural language processing (NLP). The <a href="https://CRAN.R-project.org/view=NaturalLanguageProcessing">CRAN task view on natural language processing</a> lists 53 unique packages. Some of these packages are interoperable. Some are not.</p>
<p>textmineR strives for maximum interoperability in three ways. First, it uses the <code>dgCMatrix</code> class from the popular <a href="https://CRAN.R-project.org/package=Matrix"><code>Matrix</code> package</a> for document term matrices (DTMs) and term co-occurrence matrices (TCMs). The <code>Matrix</code> package is an R “recommended” package with nearly 500 packages that depend, import, or suggest it. Compare that to the <a href="https://CRAN.R-project.org/package=slam"><code>slam</code> package</a> used by <a href="https://CRAN.R-project.org/package=tm"><code>tm</code></a> and its derivatives. <code>slam</code> has an order of magnitude fewer dependents. It is simply not as well integrated. <code>Matrix</code> also has methods that make the syntax for manipulating its matrices nearly identical to base R. This greatly reduces the cognitive burden of the programmers.</p>
<p>Second, textmineR relies on base R objects for corpus and metadata storage. Actually, it relies on the user to do so. textmineR’s core functions <code>CreateDtm</code> and <code>CreateTcm</code> take a simple character vector as input. Users may store their corpora as character vectors, lists, or data frames. <em>There is no need to learn a new <a href="https://CRAN.R-project.org/package=tm">‘Corpus’</a> class.</em></p>
<p>Third and last, textmineR represents the output of topic models in a consistent way, a list containing two matrices. This is described in more detail in the next section. Several topic models are supported and the simple representation means that textmineR’s utility functions are usable with outputs from other packages, so long as they are represented as matrices of probabilities. (Again, see the next section for more detail.)</p>
<p>textmineR achieves scalability through three means. First, sparse matrices (like the <code>dgCMatrix</code>) offer significant memory savings. Second, textmineR utilizes <code>Rcpp</code> throughout for speedup. Finally, textmineR uses parallel processing by default where possible. textmineR offers a function <code>TmParallelApply</code> which implements a framework for parallel processing that is syntactically agnostic between Windows and Unix-like operating systems. <code>TmParallelApply</code> is used liberally within textmineR and is exposed for users.</p>
<p>textmineR does make some tradeoffs of performance for syntactic simplicity. textmineR is designed to run on a single node in a cluster computing environment. It can (and will by default) use all available cores of that node. If performance is your number one concern, see <a href="https://CRAN.R-project.org/package=text2vec"><code>text2vec</code></a>. textmineR uses some <code>text2vec</code> under the hood.</p>
<p>textmineR strives for syntax that is idiomatic to R. This is, admittedly, a nebulous concept. textmineR does not create new classes where existing R classes exist. It strives for a functional programming paradigm. And it attempts to group closely-related sequential steps into single functions. This means that users will not have to make several temporary objects along the way. As an example, compare making a document term matrix in textmineR (example below) with <code>tm</code> or <code>text2vec</code>.</p>
<p>As a side note: textmineR’s framework for NLP does not need to be exclusive to textmineR. Text mining packages in R can be interoperable with a few concepts. First, use <code>dgCMatrix</code> for DTMs and TCMs. Second, write most text mining models in a way that they can take a <code>dgCMatrix</code> as the input. Finally, keep non-base R classes to a minimum, especially for corpus and metadata management.</p>
</div>
<div id="corpus-management" class="section level1">
<h1>Corpus management</h1>
<div id="creating-a-dtm" class="section level3">
<h3>Creating a DTM</h3>
<p>The basic object of analysis for most text mining applications is a document term matrix, or DTM. This is a matrix where every row represents a document and every column represents a token (word, bi-gram, stem, etc.)</p>
<p>You can create a DTM with textmineR by passing a character vector. There are options for stopword removal, creation of n-grams, and other standard data cleaning. There is an option for passing a stemming or lemmatization function if you desire. (See <code>help(CreateDtm)</code> for an example using Porter’s word stemmer.)</p>
<p>The code below uses a dataset of movie reviews included with the <code>text2vec</code> package. This dataset is used for sentiment analysis. In addition to the text of the reviews. There is a binary variable indicating positive or negative sentiment. More on this later…</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(textmineR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Loading required package: Matrix</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'textmineR'</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; The following object is masked from 'package:Matrix':</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;     update</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;     update</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># load movie_review dataset from text2vec</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">data</span>(movie_review, <span class="dt">package =</span> <span class="st">&quot;text2vec&quot;</span>)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw">str</span>(movie_review)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; 'data.frame':    5000 obs. of  3 variables:</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;  $ id       : chr  &quot;5814_8&quot; &quot;2381_9&quot; &quot;7759_3&quot; &quot;3630_4&quot; ...</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt;  $ sentiment: int  1 1 0 0 1 1 0 0 0 1 ...</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;  $ review   : chr  &quot;With all this stuff going down at the moment with MJ i've started listening to his music, watching the odd docu&quot;| __truncated__ &quot;\\\&quot;The Classic War of the Worlds\\\&quot; by Timothy Hines is a very entertaining film that obviously goes to great&quot;| __truncated__ &quot;The film starts with a manager (Nicholas Bell) giving welcome investors (Robert Carradine) to Primal Park . A s&quot;| __truncated__ &quot;It must be assumed that those who praised this film (\\\&quot;the greatest filmed opera ever,\\\&quot; didn't I read some&quot;| __truncated__ ...</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co"># let's take a sample so the demo will run quickly</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co"># note: textmineR is generally quite scaleable, depending on your system</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">s &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(movie_review), <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">movie_review &lt;-<span class="st"> </span>movie_review[ s , ]</a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co"># create a document term matrix </span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29">dtm &lt;-<span class="st"> </span><span class="kw">CreateDtm</span>(<span class="dt">doc_vec =</span> movie_review<span class="op">$</span>review, <span class="co"># character vector of documents</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">                 <span class="dt">doc_names =</span> movie_review<span class="op">$</span>id, <span class="co"># document names, optional</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">                 <span class="dt">ngram_window =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="co"># minimum and maximum n-gram length</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">                 <span class="dt">stopword_vec =</span> <span class="kw">c</span>(stopwords<span class="op">::</span><span class="kw">stopwords</span>(<span class="st">&quot;en&quot;</span>), <span class="co"># stopwords from tm</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">                                  stopwords<span class="op">::</span><span class="kw">stopwords</span>(<span class="dt">source =</span> <span class="st">&quot;smart&quot;</span>)), <span class="co"># this is the default value</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">                 <span class="dt">lower =</span> <span class="ot">TRUE</span>, <span class="co"># lowercase - this is the default value</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">                 <span class="dt">remove_punctuation =</span> <span class="ot">TRUE</span>, <span class="co"># punctuation - this is the default</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">                 <span class="dt">remove_numbers =</span> <span class="ot">TRUE</span>, <span class="co"># numbers - this is the default</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="co"># Turn off status bar for this demo</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">                 <span class="dt">cpus =</span> <span class="dv">2</span>) <span class="co"># by default, this will be the max number of cpus available</span></a></code></pre></div>
<p>Even though a <code>dgCMatrix</code> isn’t a traditional matrix, it has methods that make it similar to standard R matrices.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">dim</span>(dtm) </a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [1]   500 55459</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">nrow</span>(dtm) </a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">ncol</span>(dtm) </a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; [1] 55459</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">colnames</span>(dtm))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [1] &quot;making_debut&quot;       &quot;bureau_lowly&quot;       &quot;scenes_thing&quot;      </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [4] &quot;injections&quot;         &quot;frying_pan&quot;         &quot;renounced_assassin&quot;</span></a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">colnames(dtm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">making_debut</td>
</tr>
<tr class="even">
<td align="left">bureau_lowly</td>
</tr>
<tr class="odd">
<td align="left">scenes_thing</td>
</tr>
<tr class="even">
<td align="left">injections</td>
</tr>
<tr class="odd">
<td align="left">frying_pan</td>
</tr>
<tr class="even">
<td align="left">renounced_assassin</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">rownames</span>(dtm))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">rownames(dtm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2595_9</td>
</tr>
<tr class="even">
<td align="left">8892_2</td>
</tr>
<tr class="odd">
<td align="left">8620_8</td>
</tr>
<tr class="even">
<td align="left">2892_10</td>
</tr>
<tr class="odd">
<td align="left">232_1</td>
</tr>
<tr class="even">
<td align="left">4364_1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="basic-corpus-statistics" class="section level1">
<h1>Basic corpus statistics</h1>
<p>The code below performs some basic corpus statistics. textmineR has a built in function for getting term frequencies across the corpus. This function <code>TermDocFreq</code> gives term frequencies (equivalent to <code>colSums(dtm)</code>), the number of documents in which each term appears (equivalent to <code>colSums(dtm &gt; 0)</code>), and an inverse-document frequency (IDF) vector. The IDF vector can be used to create a TF-IDF matrix.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># get counts of tokens across the corpus</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">tf_mat &lt;-<span class="st"> </span><span class="kw">TermDocFreq</span>(<span class="dt">dtm =</span> dtm)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">str</span>(tf_mat) </a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 'data.frame':    55459 obs. of  4 variables:</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  $ term     : chr  &quot;making_debut&quot; &quot;bureau_lowly&quot; &quot;scenes_thing&quot; &quot;injections&quot; ...</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  $ term_freq: num  1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  $ doc_freq : int  1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  $ idf      : num  6.21 6.21 6.21 6.21 6.21 ...</span></a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># look at the most frequent tokens</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">head</span>(tf_mat[ <span class="kw">order</span>(tf_mat<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Ten most frequent tokens</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>br</td>
<td align="left">br</td>
<td align="right">2148</td>
<td align="right">312</td>
<td align="right">0.4716049</td>
</tr>
<tr class="even">
<td>br_br</td>
<td align="left">br_br</td>
<td align="right">1078</td>
<td align="right">312</td>
<td align="right">0.4716049</td>
</tr>
<tr class="odd">
<td>movie</td>
<td align="left">movie</td>
<td align="right">878</td>
<td align="right">310</td>
<td align="right">0.4780358</td>
</tr>
<tr class="even">
<td>film</td>
<td align="left">film</td>
<td align="right">835</td>
<td align="right">284</td>
<td align="right">0.5656339</td>
</tr>
<tr class="odd">
<td>good</td>
<td align="left">good</td>
<td align="right">333</td>
<td align="right">203</td>
<td align="right">0.9014021</td>
</tr>
<tr class="even">
<td>story</td>
<td align="left">story</td>
<td align="right">277</td>
<td align="right">167</td>
<td align="right">1.0966143</td>
</tr>
<tr class="odd">
<td>time</td>
<td align="left">time</td>
<td align="right">271</td>
<td align="right">180</td>
<td align="right">1.0216512</td>
</tr>
<tr class="even">
<td>bad</td>
<td align="left">bad</td>
<td align="right">199</td>
<td align="right">118</td>
<td align="right">1.4439235</td>
</tr>
<tr class="odd">
<td>great</td>
<td align="left">great</td>
<td align="right">195</td>
<td align="right">138</td>
<td align="right">1.2873544</td>
</tr>
<tr class="even">
<td>made</td>
<td align="left">made</td>
<td align="right">173</td>
<td align="right">137</td>
<td align="right">1.2946272</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># look at the most frequent bigrams</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">tf_bigrams &lt;-<span class="st"> </span>tf_mat[ stringr<span class="op">::</span><span class="kw">str_detect</span>(tf_mat<span class="op">$</span>term, <span class="st">&quot;_&quot;</span>) , ]</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">head</span>(tf_bigrams[ <span class="kw">order</span>(tf_bigrams<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Ten most frequent bi-grams</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>br_br</td>
<td align="left">br_br</td>
<td align="right">1078</td>
<td align="right">312</td>
<td align="right">0.4716049</td>
</tr>
<tr class="even">
<td>br_film</td>
<td align="left">br_film</td>
<td align="right">48</td>
<td align="right">41</td>
<td align="right">2.5010360</td>
</tr>
<tr class="odd">
<td>br_movie</td>
<td align="left">br_movie</td>
<td align="right">41</td>
<td align="right">36</td>
<td align="right">2.6310892</td>
</tr>
<tr class="even">
<td>film_br</td>
<td align="left">film_br</td>
<td align="right">32</td>
<td align="right">26</td>
<td align="right">2.9565116</td>
</tr>
<tr class="odd">
<td>movie_br</td>
<td align="left">movie_br</td>
<td align="right">29</td>
<td align="right">27</td>
<td align="right">2.9187712</td>
</tr>
<tr class="even">
<td>special_effects</td>
<td align="left">special_effects</td>
<td align="right">21</td>
<td align="right">19</td>
<td align="right">3.2701691</td>
</tr>
<tr class="odd">
<td>good_movie</td>
<td align="left">good_movie</td>
<td align="right">16</td>
<td align="right">15</td>
<td align="right">3.5065579</td>
</tr>
<tr class="even">
<td>long_time</td>
<td align="left">long_time</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="right">3.5065579</td>
</tr>
<tr class="odd">
<td>high_school</td>
<td align="left">high_school</td>
<td align="right">15</td>
<td align="right">10</td>
<td align="right">3.9120230</td>
</tr>
<tr class="even">
<td>scooby_doo</td>
<td align="left">scooby_doo</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">6.2146081</td>
</tr>
</tbody>
</table>
<p>It looks like we have stray html tags (“&lt;br&gt;”) in the documents. These aren’t giving us any relevant information about content. (Except, perhaps, that these documents were originally part of web pages.)</p>
<p>The most intuitive approach, perhaps, is to strip these tags from our documents, re-construct a document term matrix, and re-calculate the objects as above. However, a simpler approach would be to simply remove the tokens containing “br” from the DTM we already calculated. This is much more computationally efficient and gives us the same result anyway.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># remove offending tokens from the DTM</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">dtm &lt;-<span class="st"> </span>dtm[ , <span class="op">!</span><span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_detect</span>(<span class="kw">colnames</span>(dtm),</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                                    <span class="st">&quot;(^br$)|(_br$)|(^br_)&quot;</span>) ]</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"># re-construct tf_mat and tf_bigrams</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">tf_mat &lt;-<span class="st"> </span><span class="kw">TermDocFreq</span>(dtm)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">tf_bigrams &lt;-<span class="st"> </span>tf_mat[ stringr<span class="op">::</span><span class="kw">str_detect</span>(tf_mat<span class="op">$</span>term, <span class="st">&quot;_&quot;</span>) , ]</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">head</span>(tf_mat[ <span class="kw">order</span>(tf_mat<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt;        term term_freq doc_freq       idf</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; movie movie       878      310 0.4780358</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; film   film       835      284 0.5656339</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; good   good       333      203 0.9014021</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; story story       277      167 1.0966143</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; time   time       271      180 1.0216512</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; bad     bad       199      118 1.4439235</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; great great       195      138 1.2873544</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; made   made       173      137 1.2946272</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; watch watch       158      127 1.3704210</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; films films       153       93 1.6820086</span></a></code></pre></div>
<table>
<caption>Ten most frequent terms, ‘&lt;br&gt;’ removed</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>movie</td>
<td align="left">movie</td>
<td align="right">878</td>
<td align="right">310</td>
<td align="right">0.4780358</td>
</tr>
<tr class="even">
<td>film</td>
<td align="left">film</td>
<td align="right">835</td>
<td align="right">284</td>
<td align="right">0.5656339</td>
</tr>
<tr class="odd">
<td>good</td>
<td align="left">good</td>
<td align="right">333</td>
<td align="right">203</td>
<td align="right">0.9014021</td>
</tr>
<tr class="even">
<td>story</td>
<td align="left">story</td>
<td align="right">277</td>
<td align="right">167</td>
<td align="right">1.0966143</td>
</tr>
<tr class="odd">
<td>time</td>
<td align="left">time</td>
<td align="right">271</td>
<td align="right">180</td>
<td align="right">1.0216512</td>
</tr>
<tr class="even">
<td>bad</td>
<td align="left">bad</td>
<td align="right">199</td>
<td align="right">118</td>
<td align="right">1.4439235</td>
</tr>
<tr class="odd">
<td>great</td>
<td align="left">great</td>
<td align="right">195</td>
<td align="right">138</td>
<td align="right">1.2873544</td>
</tr>
<tr class="even">
<td>made</td>
<td align="left">made</td>
<td align="right">173</td>
<td align="right">137</td>
<td align="right">1.2946272</td>
</tr>
<tr class="odd">
<td>watch</td>
<td align="left">watch</td>
<td align="right">158</td>
<td align="right">127</td>
<td align="right">1.3704210</td>
</tr>
<tr class="even">
<td>films</td>
<td align="left">films</td>
<td align="right">153</td>
<td align="right">93</td>
<td align="right">1.6820086</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">head</span>(tf_bigrams[ <span class="kw">order</span>(tf_bigrams<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Ten most frequent bi-grams, ‘&lt;br&gt;’ removed</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>special_effects</td>
<td align="left">special_effects</td>
<td align="right">21</td>
<td align="right">19</td>
<td align="right">3.270169</td>
</tr>
<tr class="even">
<td>good_movie</td>
<td align="left">good_movie</td>
<td align="right">16</td>
<td align="right">15</td>
<td align="right">3.506558</td>
</tr>
<tr class="odd">
<td>long_time</td>
<td align="left">long_time</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="right">3.506558</td>
</tr>
<tr class="even">
<td>high_school</td>
<td align="left">high_school</td>
<td align="right">15</td>
<td align="right">10</td>
<td align="right">3.912023</td>
</tr>
<tr class="odd">
<td>scooby_doo</td>
<td align="left">scooby_doo</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">6.214608</td>
</tr>
<tr class="even">
<td>low_budget</td>
<td align="left">low_budget</td>
<td align="right">15</td>
<td align="right">13</td>
<td align="right">3.649659</td>
</tr>
<tr class="odd">
<td>watch_movie</td>
<td align="left">watch_movie</td>
<td align="right">14</td>
<td align="right">13</td>
<td align="right">3.649659</td>
</tr>
<tr class="even">
<td>make_film</td>
<td align="left">make_film</td>
<td align="right">14</td>
<td align="right">13</td>
<td align="right">3.649659</td>
</tr>
<tr class="odd">
<td>years_ago</td>
<td align="left">years_ago</td>
<td align="right">14</td>
<td align="right">13</td>
<td align="right">3.649659</td>
</tr>
<tr class="even">
<td>movie_good</td>
<td align="left">movie_good</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">3.649659</td>
</tr>
</tbody>
</table>
<p>We can also calculate how many tokens each document contains from the DTM. Note that this reflects the modifications we made in constructing the DTM (removing stop words, punctuation, numbers, etc.).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># summary of document lengths</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">doc_lengths &lt;-<span class="st"> </span><span class="kw">rowSums</span>(dtm)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">summary</span>(doc_lengths)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;    23.0    96.0   140.5   186.1   245.0   768.0</span></a></code></pre></div>
<p>Often,it’s useful to prune your vocabulary and remove any tokens that appear in a small number of documents. This will greatly reduce the vocabulary size (see <a href="https://en.wikipedia.org/wiki/Zipf%27s_law">Zipf’s law</a>) and improve computation time.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># remove any tokens that were in 3 or fewer documents</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">dtm &lt;-<span class="st"> </span>dtm[ , <span class="kw">colSums</span>(dtm <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> ] <span class="co"># alternatively: dtm[ , tf_mat$term_freq &gt; 3 ]</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">tf_mat &lt;-<span class="st"> </span>tf_mat[ tf_mat<span class="op">$</span>term <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(dtm) , ]</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">tf_bigrams &lt;-<span class="st"> </span>tf_bigrams[ tf_bigrams<span class="op">$</span>term <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(dtm) , ]</a></code></pre></div>
<p>The movie review data set contains more than just text of reviews. It also contains a variable tagging the review as positive (<code>movie_review$sentiment</code> <span class="math inline">\(=1\)</span>) or negative (<code>movie_review$sentiment</code> <span class="math inline">\(=0\)</span>). We can examine terms associated with positive and negative reviews. If we wanted, we could use them to build a simple classifier.</p>
<p>However, as we will see immediately below, looking at only the most frequent terms in each category is not helpful. Because of Zipf’s law, the most frequent terms in just about <em>any</em> category will be the same.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># what words are most associated with sentiment?</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">tf_sentiment &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">positive =</span> <span class="kw">TermDocFreq</span>(dtm[ movie_review<span class="op">$</span>sentiment <span class="op">==</span><span class="st"> </span><span class="dv">1</span> , ]),</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                     <span class="dt">negative =</span> <span class="kw">TermDocFreq</span>(dtm[ movie_review<span class="op">$</span>sentiment <span class="op">==</span><span class="st"> </span><span class="dv">0</span> , ]))</a></code></pre></div>
<p>These are basically the same. Not helpful at all.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">head</span>(tf_sentiment<span class="op">$</span>positive[ <span class="kw">order</span>(tf_sentiment<span class="op">$</span>positive<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Ten most-frequent positive tokens</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>movie</td>
<td align="left">movie</td>
<td align="right">358</td>
<td align="right">128</td>
<td align="right">0.5990082</td>
</tr>
<tr class="even">
<td>film</td>
<td align="left">film</td>
<td align="right">349</td>
<td align="right">125</td>
<td align="right">0.6227247</td>
</tr>
<tr class="odd">
<td>story</td>
<td align="left">story</td>
<td align="right">143</td>
<td align="right">82</td>
<td align="right">1.0443192</td>
</tr>
<tr class="even">
<td>good</td>
<td align="left">good</td>
<td align="right">138</td>
<td align="right">83</td>
<td align="right">1.0321978</td>
</tr>
<tr class="odd">
<td>time</td>
<td align="left">time</td>
<td align="right">125</td>
<td align="right">82</td>
<td align="right">1.0443192</td>
</tr>
<tr class="even">
<td>great</td>
<td align="left">great</td>
<td align="right">119</td>
<td align="right">79</td>
<td align="right">1.0815906</td>
</tr>
<tr class="odd">
<td>watch</td>
<td align="left">watch</td>
<td align="right">82</td>
<td align="right">59</td>
<td align="right">1.3735010</td>
</tr>
<tr class="even">
<td>love</td>
<td align="left">love</td>
<td align="right">71</td>
<td align="right">49</td>
<td align="right">1.5592182</td>
</tr>
<tr class="odd">
<td>life</td>
<td align="left">life</td>
<td align="right">69</td>
<td align="right">49</td>
<td align="right">1.5592182</td>
</tr>
<tr class="even">
<td>character</td>
<td align="left">character</td>
<td align="right">69</td>
<td align="right">53</td>
<td align="right">1.4807465</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">head</span>(tf_sentiment<span class="op">$</span>negative[ <span class="kw">order</span>(tf_sentiment<span class="op">$</span>negative<span class="op">$</span>term_freq, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Ten most-frequent negative tokens</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>movie</td>
<td align="left">movie</td>
<td align="right">520</td>
<td align="right">182</td>
<td align="right">0.3832420</td>
</tr>
<tr class="even">
<td>film</td>
<td align="left">film</td>
<td align="right">486</td>
<td align="right">159</td>
<td align="right">0.5183445</td>
</tr>
<tr class="odd">
<td>good</td>
<td align="left">good</td>
<td align="right">195</td>
<td align="right">120</td>
<td align="right">0.7997569</td>
</tr>
<tr class="even">
<td>bad</td>
<td align="left">bad</td>
<td align="right">164</td>
<td align="right">90</td>
<td align="right">1.0874390</td>
</tr>
<tr class="odd">
<td>time</td>
<td align="left">time</td>
<td align="right">146</td>
<td align="right">98</td>
<td align="right">1.0022812</td>
</tr>
<tr class="even">
<td>story</td>
<td align="left">story</td>
<td align="right">134</td>
<td align="right">85</td>
<td align="right">1.1445974</td>
</tr>
<tr class="odd">
<td>made</td>
<td align="left">made</td>
<td align="right">111</td>
<td align="right">83</td>
<td align="right">1.1684081</td>
</tr>
<tr class="even">
<td>people</td>
<td align="left">people</td>
<td align="right">104</td>
<td align="right">68</td>
<td align="right">1.3677410</td>
</tr>
<tr class="odd">
<td>acting</td>
<td align="left">acting</td>
<td align="right">102</td>
<td align="right">79</td>
<td align="right">1.2178008</td>
</tr>
<tr class="even">
<td>make</td>
<td align="left">make</td>
<td align="right">89</td>
<td align="right">70</td>
<td align="right">1.3387534</td>
</tr>
</tbody>
</table>
<p>That was unhelpful. Instead, we need to re-weight the terms in each class. We’ll use a probabilistic reweighting, described below.</p>
<p>The most frequent words in each class are proportional to <span class="math inline">\(P(word|sentiment_j)\)</span>. As we saw above, that would puts the words in the same order as <span class="math inline">\(P(word)\)</span>, overall. However, we can use the difference in those probabilities to get a new order. That difference is</p>
<p><span class="math display">\[\begin{align}
  P(word|sentiment_j) - P(word)
\end{align}\]</span></p>
<p>You can interpret the difference in (1) as follows: Positive values are more probable in the sentiment class than in the corpus overall. Negative values are less probable. Values close to zero are statistically-independent of sentiment. Since most of the top words are the same when we sort by <span class="math inline">\(P(word|sentiment_j)\)</span>, these words are statistically-independent of sentiment. They get forced towards zero.</p>
<p>For those paying close attention, this difference should give a similar ordering as pointwise-mutual information (PMI), defined as <span class="math inline">\(PMI = \frac{P(word|sentiment_j)}{P(word)}\)</span>. However, I prefer the difference as it is bound between <span class="math inline">\(-1\)</span> and <span class="math inline">\(1\)</span>.</p>
<p>The difference method is applied to both words overall and bi-grams in the code below.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co"># let's reweight by probability by class</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">p_words &lt;-<span class="st"> </span><span class="kw">colSums</span>(dtm) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(dtm) <span class="co"># alternatively: tf_mat$term_freq / sum(tf_mat$term_freq)</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">tf_sentiment<span class="op">$</span>positive<span class="op">$</span>conditional_prob &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="st">  </span>tf_sentiment<span class="op">$</span>positive<span class="op">$</span>term_freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tf_sentiment<span class="op">$</span>positive<span class="op">$</span>term_freq)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">tf_sentiment<span class="op">$</span>positive<span class="op">$</span>prob_lift &lt;-<span class="st"> </span>tf_sentiment<span class="op">$</span>positive<span class="op">$</span>conditional_prob <span class="op">-</span><span class="st"> </span>p_words</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"></a>
<a class="sourceLine" id="cb17-10" data-line-number="10">tf_sentiment<span class="op">$</span>negative<span class="op">$</span>conditional_prob &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span>tf_sentiment<span class="op">$</span>negative<span class="op">$</span>term_freq <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tf_sentiment<span class="op">$</span>negative<span class="op">$</span>term_freq)</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">tf_sentiment<span class="op">$</span>negative<span class="op">$</span>prob_lift &lt;-<span class="st"> </span>tf_sentiment<span class="op">$</span>negative<span class="op">$</span>conditional_prob <span class="op">-</span><span class="st"> </span>p_words</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># let's look again with new weights</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">head</span>(tf_sentiment<span class="op">$</span>positive[ <span class="kw">order</span>(tf_sentiment<span class="op">$</span>positive<span class="op">$</span>prob_lift, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Reweighted: ten most relevant terms for positive sentiment</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
<th align="right">conditional_prob</th>
<th align="right">prob_lift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>great</td>
<td align="left">great</td>
<td align="right">119</td>
<td align="right">79</td>
<td align="right">1.081591</td>
<td align="right">0.0081168</td>
<td align="right">0.0022971</td>
</tr>
<tr class="even">
<td>heart</td>
<td align="left">heart</td>
<td align="right">42</td>
<td align="right">17</td>
<td align="right">2.617825</td>
<td align="right">0.0028647</td>
<td align="right">0.0015217</td>
</tr>
<tr class="odd">
<td>story</td>
<td align="left">story</td>
<td align="right">143</td>
<td align="right">82</td>
<td align="right">1.044319</td>
<td align="right">0.0097538</td>
<td align="right">0.0014868</td>
</tr>
<tr class="even">
<td>life</td>
<td align="left">life</td>
<td align="right">69</td>
<td align="right">49</td>
<td align="right">1.559218</td>
<td align="right">0.0047064</td>
<td align="right">0.0012444</td>
</tr>
<tr class="odd">
<td>excellent</td>
<td align="left">excellent</td>
<td align="right">38</td>
<td align="right">33</td>
<td align="right">1.954531</td>
<td align="right">0.0025919</td>
<td align="right">0.0012191</td>
</tr>
<tr class="even">
<td>beautiful</td>
<td align="left">beautiful</td>
<td align="right">39</td>
<td align="right">28</td>
<td align="right">2.118834</td>
<td align="right">0.0026601</td>
<td align="right">0.0011977</td>
</tr>
<tr class="odd">
<td>find</td>
<td align="left">find</td>
<td align="right">51</td>
<td align="right">41</td>
<td align="right">1.737466</td>
<td align="right">0.0034786</td>
<td align="right">0.0009418</td>
</tr>
<tr class="even">
<td>world</td>
<td align="left">world</td>
<td align="right">49</td>
<td align="right">38</td>
<td align="right">1.813452</td>
<td align="right">0.0033422</td>
<td align="right">0.0008950</td>
</tr>
<tr class="odd">
<td>watch</td>
<td align="left">watch</td>
<td align="right">82</td>
<td align="right">59</td>
<td align="right">1.373501</td>
<td align="right">0.0055931</td>
<td align="right">0.0008776</td>
</tr>
<tr class="even">
<td>years</td>
<td align="left">years</td>
<td align="right">60</td>
<td align="right">43</td>
<td align="right">1.689838</td>
<td align="right">0.0040925</td>
<td align="right">0.0008693</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">head</span>(tf_sentiment<span class="op">$</span>negative[ <span class="kw">order</span>(tf_sentiment<span class="op">$</span>negative<span class="op">$</span>prob_lift, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ], <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Reweighted: ten most relevant terms for negative sentiment</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
<th align="right">conditional_prob</th>
<th align="right">prob_lift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bad</td>
<td align="left">bad</td>
<td align="right">164</td>
<td align="right">90</td>
<td align="right">1.0874390</td>
<td align="right">0.0087021</td>
<td align="right">0.0027631</td>
</tr>
<tr class="even">
<td>movie</td>
<td align="left">movie</td>
<td align="right">520</td>
<td align="right">182</td>
<td align="right">0.3832420</td>
<td align="right">0.0275921</td>
<td align="right">0.0013886</td>
</tr>
<tr class="odd">
<td>people</td>
<td align="left">people</td>
<td align="right">104</td>
<td align="right">68</td>
<td align="right">1.3677410</td>
<td align="right">0.0055184</td>
<td align="right">0.0011313</td>
</tr>
<tr class="even">
<td>worst</td>
<td align="left">worst</td>
<td align="right">55</td>
<td align="right">48</td>
<td align="right">1.7160476</td>
<td align="right">0.0029184</td>
<td align="right">0.0011277</td>
</tr>
<tr class="odd">
<td>script</td>
<td align="left">script</td>
<td align="right">62</td>
<td align="right">50</td>
<td align="right">1.6752257</td>
<td align="right">0.0032898</td>
<td align="right">0.0009023</td>
</tr>
<tr class="even">
<td>acting</td>
<td align="left">acting</td>
<td align="right">102</td>
<td align="right">79</td>
<td align="right">1.2178008</td>
<td align="right">0.0054123</td>
<td align="right">0.0008759</td>
</tr>
<tr class="odd">
<td>film</td>
<td align="left">film</td>
<td align="right">486</td>
<td align="right">159</td>
<td align="right">0.5183445</td>
<td align="right">0.0257880</td>
<td align="right">0.0008678</td>
</tr>
<tr class="even">
<td>guy</td>
<td align="left">guy</td>
<td align="right">55</td>
<td align="right">33</td>
<td align="right">2.0907411</td>
<td align="right">0.0029184</td>
<td align="right">0.0008591</td>
</tr>
<tr class="odd">
<td>thing</td>
<td align="left">thing</td>
<td align="right">66</td>
<td align="right">56</td>
<td align="right">1.5618970</td>
<td align="right">0.0035021</td>
<td align="right">0.0007564</td>
</tr>
<tr class="even">
<td>awful</td>
<td align="left">awful</td>
<td align="right">35</td>
<td align="right">24</td>
<td align="right">2.4091948</td>
<td align="right">0.0018572</td>
<td align="right">0.0007529</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># what about bi-grams?</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">tf_sentiment_bigram &lt;-<span class="st"> </span><span class="kw">lapply</span>(tf_sentiment, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  x &lt;-<span class="st"> </span>x[ stringr<span class="op">::</span><span class="kw">str_detect</span>(x<span class="op">$</span>term, <span class="st">&quot;_&quot;</span>) , ]</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  x[ <span class="kw">order</span>(x<span class="op">$</span>prob_lift, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>) , ]</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">})</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">head</span>(tf_sentiment_bigram<span class="op">$</span>positive, <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Reweighted: ten most relevant bigrams for positive sentiment</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
<th align="right">conditional_prob</th>
<th align="right">prob_lift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>highly_recommend</td>
<td align="left">highly_recommend</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">3.053143</td>
<td align="right">0.0007503</td>
<td align="right">0.0003922</td>
</tr>
<tr class="even">
<td>big_screen</td>
<td align="left">big_screen</td>
<td align="right">8</td>
<td align="right">5</td>
<td align="right">3.841601</td>
<td align="right">0.0005457</td>
<td align="right">0.0002771</td>
</tr>
<tr class="odd">
<td>real_life</td>
<td align="left">real_life</td>
<td align="right">9</td>
<td align="right">8</td>
<td align="right">3.371597</td>
<td align="right">0.0006139</td>
<td align="right">0.0002557</td>
</tr>
<tr class="even">
<td>world_war</td>
<td align="left">world_war</td>
<td align="right">8</td>
<td align="right">5</td>
<td align="right">3.841601</td>
<td align="right">0.0005457</td>
<td align="right">0.0002174</td>
</tr>
<tr class="odd">
<td>watched_movie</td>
<td align="left">watched_movie</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">3.505128</td>
<td align="right">0.0004775</td>
<td align="right">0.0002089</td>
</tr>
<tr class="even">
<td>enjoy_watching</td>
<td align="left">enjoy_watching</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">3.659279</td>
<td align="right">0.0004092</td>
<td align="right">0.0002003</td>
</tr>
<tr class="odd">
<td>years_ago</td>
<td align="left">years_ago</td>
<td align="right">9</td>
<td align="right">8</td>
<td align="right">3.371597</td>
<td align="right">0.0006139</td>
<td align="right">0.0001961</td>
</tr>
<tr class="even">
<td>makes_movie</td>
<td align="left">makes_movie</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">3.841601</td>
<td align="right">0.0003410</td>
<td align="right">0.0001918</td>
</tr>
<tr class="odd">
<td>loved_movie</td>
<td align="left">loved_movie</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">3.841601</td>
<td align="right">0.0003410</td>
<td align="right">0.0001918</td>
</tr>
<tr class="even">
<td>movie_worth</td>
<td align="left">movie_worth</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">3.659279</td>
<td align="right">0.0004092</td>
<td align="right">0.0001705</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">head</span>(tf_sentiment_bigram<span class="op">$</span>negative, <span class="dv">10</span>)</a></code></pre></div>
<table>
<caption>Reweighted: ten most relevant bigrams for negative sentiment</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">term</th>
<th align="right">term_freq</th>
<th align="right">doc_freq</th>
<th align="right">idf</th>
<th align="right">conditional_prob</th>
<th align="right">prob_lift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>good_thing</td>
<td align="left">good_thing</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">3.189353</td>
<td align="right">0.0005837</td>
<td align="right">0.0002554</td>
</tr>
<tr class="even">
<td>waste_time</td>
<td align="left">waste_time</td>
<td align="right">12</td>
<td align="right">11</td>
<td align="right">3.189353</td>
<td align="right">0.0006367</td>
<td align="right">0.0002488</td>
</tr>
<tr class="odd">
<td>acting_bad</td>
<td align="left">acting_bad</td>
<td align="right">10</td>
<td align="right">9</td>
<td align="right">3.390024</td>
<td align="right">0.0005306</td>
<td align="right">0.0002322</td>
</tr>
<tr class="even">
<td>bad_acting</td>
<td align="left">bad_acting</td>
<td align="right">9</td>
<td align="right">9</td>
<td align="right">3.390024</td>
<td align="right">0.0004776</td>
<td align="right">0.0002090</td>
</tr>
<tr class="odd">
<td>worst_movie</td>
<td align="left">worst_movie</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">3.284664</td>
<td align="right">0.0005306</td>
<td align="right">0.0002023</td>
</tr>
<tr class="even">
<td>read_book</td>
<td align="left">read_book</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">3.795489</td>
<td align="right">0.0004245</td>
<td align="right">0.0001857</td>
</tr>
<tr class="odd">
<td>comic_book</td>
<td align="left">comic_book</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">3.795489</td>
<td align="right">0.0004245</td>
<td align="right">0.0001857</td>
</tr>
<tr class="even">
<td>great_idea</td>
<td align="left">great_idea</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">3.641338</td>
<td align="right">0.0003714</td>
<td align="right">0.0001625</td>
</tr>
<tr class="odd">
<td>bad_guys</td>
<td align="left">bad_guys</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">3.795489</td>
<td align="right">0.0004245</td>
<td align="right">0.0001559</td>
</tr>
<tr class="even">
<td>make_sense</td>
<td align="left">make_sense</td>
<td align="right">8</td>
<td align="right">6</td>
<td align="right">3.795489</td>
<td align="right">0.0004245</td>
<td align="right">0.0001559</td>
</tr>
</tbody>
</table>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
